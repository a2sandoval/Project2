<!DOCTYPE html>
<html>

<head>
  <!--Import Google Icon Font-->
  <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
  <!--Import materialize.css-->
  <!-- Compiled and minified CSS -->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/materialize/1.0.0/css/materialize.min.css">
  <link href="css/styles.css" type="text/css" rel="stylesheet" media="screen,projection" />


  <!--Let browser know website is optimized for mobile-->
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Create Your Character</title>

  <style>
    .switch label input[type=checkbox]:checked+.lever:after {
    background-color: #1976d2;
    }
  </style>

  <!-- Favicon -->
  <link rel="shortcut icon" href="images/favicon.ico" type="image/x-icon">
  <link rel="icon" href="images/favicon.ico" type="image/x-icon">
</head>

<body>

  <nav class=" light-blue darken-4 " role="navigation">
    <div class="nav-wrapper container"><a id="logo-container"  class="brand-logo">The What?</a>
      <ul class="right hide-on-med-and-down">
        <li><a href="">Create a Character</a></li>
        <li><a href="/">Created Characters</a></li>
      </ul>

      <ul id="nav-mobile" class="sidenav">
        <li><a href="">Create a Character</a></li>

        <li><a href="/">Created Characters</a></li>
      </ul>
      <a href="#" data-target="nav-mobile" class="sidenav-trigger"><i class="material-icons">menu</i></a>
    </div>
  </nav>
  <div class="section no-pad-bot" id="index-banner">
    <div class="container">
      <br><br>
      <h1 class="header center orange-text">Instructions:</h1>
      <div class="row center">
        <h5 class="header col s12 light">It's time to create your character! Enter their bio data, and your name and
          then
          simply select from the charactersitics below. </h5>
      </div>
      <!-- <div class="row center">
            <a href="http://materializecss.com/getting-started.html" id="download-button" class="btn-large waves-effect waves-light orange">Get Started</a>
          </div>
          <br><br> -->

    </div>
  </div>

  <div class="container">
    <!-- Page Content goes here -->
    <div class="section">

      <div class="row">
        <form class="col s12">
          <div class="row">
            <div class="input-field col s12">
              <input placeholder="Rose Tyler" id="first_name" type="text" class="validate">
              <label for="character_name">Character Name</label>
            </div>
          </div>

          <div class="row">
            <div class="input-field col s12">
              <input placeholder="http://badassimageofyourcharcter.com/image.jpg" id="character_image" type="text"
                class="validate">
              <label for="character_image">Character Image URL</label>
            </div>
          </div>

          <div class="row">
            <div class="input-field col s12">
              <textarea id="character_description" class="materialize-textarea" placeholder="Quick description of your character"></textarea>
              <label for="textarea1">Description</label>
            </div>
          </div>

          <div class="row">
            <div class="input-field col s12">
              <textarea id="character_background" class="materialize-textarea" placeholder="Your character's full backstory"></textarea>
              <label for="textarea2">Background</label>
            </div>
          </div>

          <div class="row">
            <div class="input-field col s12">
              <input placeholder="Amelia" id="player_name" type="text" class="validate">
              <label for="player_name">Player Name</label>
            </div>
          </div>


        </form>
      </div>
    </div>
    <!--   Characteristics Section   -->
    <div class="section">
      <h2>Attributes</h2>
      <h6><span id="characterPoints">18</span> Character Points left!</h6>
      <div class="row">
        <form class="col s12">
          <div class="row">

            <div class="col s1 m3 l4">
              <label>Awareness</label>
              <input oninput="controller()" type="number" class="short-input" value=0 id="attrAw" min="0" max="24">
            </div>

            <div class="col s1 m3 l4">
              <label>Coordination</label>
              <input oninput="controller()" type="number" class="short-input" value=0 id="attrCo" min="0" max="24">
            </div>

            <div class="col s1 m3 l4">
              <label>Ingenuity</label>
              <input oninput="controller()" type="number" class="short-input" value=0 id="attrIn" min="0" max="24">
            </div>

            <div class="col s1 m3 l4">
              <label>Presence</label>
              <input oninput="controller()" type="number" class="short-input" value=0 id="attrPr" min="0" max="24">
            </div>


            <div class="col s1 m3 l4">
              <label>Resolve</label>
              <input oninput="controller()" type="number" class="short-input" value=0 id="attrRe" min="0" max="24">
            </div>

            <div class="col s1 m3 l4">
              <label>Strength</label>
              <input oninput="controller()" type="number" class="short-input" value=0 id="attrSt" min="0" max="24">
            </div>


          </div>

        </form>

      </div>
    </div>
    <!------- Traits Section-------->

    <div class="section">
      <h2>Traits</h2>
      <h6><span id="characterPoints2">18</span> Character Points left!</h6>
      <div class="row">
        <form class="col s12">
          <div class="row" id="traitsHere">


          </div>
        </form>
      </div>
    </div>
    <!------- Attributes Section ------>

    <div class="section ">
      <h2>Skills</h2>
      <h6><span id="skillzPoints">18</span> points left!</h6>
      <div class="row">
        <form class="col s12">
          <div class="row">

            <div class="col s1 m3 l3">
              <label>Athletics</label>
              <input oninput="controller2()" type="number" class="short-input" value=0 id="skAthletics" min="0" max="24">
            </div>

            <div class="col s1 m3 l3">
              <label>Convince</label>
              <input oninput="controller2()" type="number" class="short-input" value=0 id="skConvince" min="0" max="24">
            </div>

            <div class="col s1 m3 l3">
              <label>Craft</label>
              <input oninput="controller2()" type="number" class="short-input" value=0 id="skCraft" min="0" max="24">
            </div>

            <div class="col s1 m3 l3">
              <label>Fighting</label>
              <input oninput="controller2()" type="number" class="short-input" value=0 id="skFighting" min="0" max="24">
            </div>


            <div class="col s1 m3 l3">
              <label>Knowledge</label>
              <input oninput="controller2()" type="number" class="short-input" value=0 id="skKnowledge" min="0" max="24">
            </div>

            <div class="col s1 m3 l3">
              <label>Marksman</label>
              <input oninput="controller2()" type="number" class="short-input" value=0 id="skMarksman" min="0" max="24">
            </div>

            <div class="col s1 m3 l3">
              <label>Medicine</label>
              <input oninput="controller2()" type="number" class="short-input" value=0 id="skMedicine" min="0" max="24">
            </div>

            <div class="col s1 m3 l3">
              <label>Science</label>
              <input oninput="controller2()" type="number" class="short-input" value=0 id="skScience" min="0" max="24">
            </div>


            <div class="col s1 m3 l3">
              <label>Subterfuge</label>
              <input oninput="controller2()" type="number" class="short-input" value=0 id="skSubterfuge" min="0" max="24">
            </div>

            <div class="col s1 m3 l3">
              <label>Survival</label>
              <input oninput="controller2()" type="number" class="short-input" value=0 id="skSurvival" min="0" max="24">
            </div>

            <div class="col s1 m3 l3">
              <label>Technology</label>
              <input oninput="controller2()" type="number" class="short-input" value=0 id="skTechnology" min="0" max="24">
            </div>

            <div class="col s1 m3 l3">
              <label>Transport</label>
              <input oninput="controller2()" type="number" class="short-input" value=0 id="skTransport" min="0" max="24">
            </div>


          </div>

        </form>

      </div>
      <div class="row">
        <div class="col s12 offset-s9 ms6 offset-s7 l12 offset-l10">
          <br>
          <button onclick="saveCharacter()" class="btn waves-effect waves-light blue darken-4" type="submit" name="action" id="submit">Submit
            <i class="material-icons right">send</i>
          </button>
        </div>
      </div>
    </div>


  </div>



  <footer class="page-footer  light-blue darken-4">
    <div class="container">
      <div class="row">
        <div class="col l6 s12">
          <h5 class="white-text">Team Bio</h5>
          <p class="grey-text text-lighten-4">We are a team of Coding Bootcamp students working on this project
            like
            it's our full time job. Check out our github below!</p>

          <div class="footer-copyright">
            <div class="container">
              Check us out on <a class=" text-lighten-3" href="https://github.com/a2sandoval/Project2">Github</a>
              <br>
              Check us out on  <a class=" text-lighten-3" href="https://the-what.herokuapp.com/">Heroku</a>
            </div>
          </div>
        </div>
      </div>
    </div>
  </footer>

  <!--JavaScript at end of body for optimized loading-->
  <!-- Compiled and minified JavaScript -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/materialize/1.0.0/js/materialize.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.2.1/jquery.min.js"></script>

  <!-- <script src="./js/index.js"></script> -->
  <!-- <script src="js/loadTraits.js"></script> -->
  <script type="text/javascript">
    function createTrait(info) {
      var newTrait = $("<div>").addClass("col s1 m3");
      var mainLabel = $("<label>").html(info.name);
      var switchDiv = $("<div>").addClass("switch");
      var subLabel = $("<label>");
      var traitInput = "<input oninput='controller()' type='checkbox' class='blue darken-4' unchecked id='trait" + info.id + "' cost='" + info.cost + "' data-id='" + info.id + "'/>";
      //console.log(info.cost);
      var lever = $("<span>").addClass("lever blue darken-4");
      subLabel.append("Off", traitInput, lever, "On");
      switchDiv.append(subLabel);
      newTrait.append(mainLabel, switchDiv);
      return newTrait;
    };

    function loadAllTraits() {
      $.ajax({
        method: "GET",
        url: "/api/static/traits"
      }).then(function (data) {
        // loop through all traits
        var testTrait = {
          name: "Test Trait",
          id: 0,
          cost: 5
        };
        var testTraitttt = createTrait(testTrait);
        for (var i = 0; i < data.length; i++) {
          var newTrait = createTrait(data[i]);
          $("#traitsHere").append(newTrait);
        };
        $("#traitsHere").append(testTraitttt);
      });
    };

    $(document).ready(function () {
      loadAllTraits();
    });

    var formSubmit = function (event) {
      event.preventDefault();

      // Creation of object to pass to POST URLs
      // TODO create reference for stuff

      // TODO: correct references
      var charAttributes = {
        "attrAwMax": $("#attrAw").val(),
        "attrAwCurr": $("#attrAw").val(),
        "attrCoMax": $("#attrCo").val(),
        "attrCoCurr": $("#attrCo").val(),
        "attrInMax": $("#attrIn").val(),
        "attrInCurr": $("#attrIn").val(),
        "attrPrMax": $("#attrPr").val(),
        "attrPrCurr": $("#attrPr").val(),
        "attrReMax": $("#attrRe").val(),
        "attrReCurr": $("#attrRe").val(),
        "attrStMax": $("#attrSt").val(),
        "attrStCurr": $("#attrSt").val()
      };

      var charSkillz = {
        "skAthletics": $("#skAthletics").val(),
        "skConvince": $("#skConvince").val(),
        "skCraft": $("#skCraft").val(),
        "skFighting": $("#skFighting").val(),
        "skKnowledge": $("#skKnowledge").val(),
        "skMarksman": $("#skMarksman").val(),
        "skMedicine": $("#skMedicine").val(),
        "skScience": $("#skScience").val(),
        "skSubterfuge": $("#skSubterfuge").val(),
        "skSurvival": $("#skSurvival").val(),
        "skTechnology": $("#skTechnology").val(),
        "skTransport": $("#skTransport").val()
      };
      // Format and load all of the trait that the player checked off
      var charTraits = {
        "trait1": 0,
        "trait2": 0,
        "trait3": 0,
        "trait4": 0,
        "trait5": 0,
        "trait6": 0,
        "trait7": 0,
        "trait8": 0,
        "trait9": 0,
        "trait10": 0, 
        "trait11": 0,
        "trait12": 0
      };
      var count = 1;
      $("input:checked").each(function () {
        if (count <= 12) {
          var temp = "trait" + count;
          charTraits[temp] = parseInt($(this).attr("data-id"));
          count++;
        }
      });
      console.log(charTraits);
      console.log(charSkillz);
      console.log(charAttributes);

      $.ajax({
        headers: {
          "Content-Type": "application/json"
        },
        type: "POST",
        url: "/api/characters/attributes",
        data: JSON.stringify(charAttributes)
      }).then(function (attributesData) {
        console.log("Attributes sent to database!");
        $.ajax({
          headers: {
            "Content-Type": "application/json"
          },
          type: "POST",
          url: "/api/characters/skills",
          data: JSON.stringify(charSkillz)
        }).then(function (skillzData) {
          console.log("Skills sent to database!");
          $.ajax({
            headers: {
              "Content-Type": "application/json"
            },
            type: "POST",
            url: "/api/characters/traits",
            data: JSON.stringify(charTraits)
          }).then(function (traitsData) {
            console.log("Traits sent to database!");
            var characterBase = {
              "playerName": $("#player_name").val().trim(),
              "charName": $("#first_name").val().trim(),
              "image": $("#character_image").val().trim(),
              "description": $("#character_description").val().trim(),
              "background": $("#character_background").val().trim(),
              "stuff": "stuff",
              "CharacterAttrId": attributesData.id,
              "CharacterSkillId": skillzData.id,
              "CharacterTraitId": traitsData.id
            };
            $.ajax({
              headers: {
                "Content-Type": "application/json"
              },
              type: "POST",
              url: "/api/characters",
              data: JSON.stringify(characterBase)
            }).then(function (charData) {
              console.log("Basic Info sent to database!");

              // window.open('https://the-what.herokuapp.com/');
            });
          });
        });
      });
      // TODO: correct reference







    };
    $("#submit").on("click", formSubmit);
    
    console.log("JS File Loaded");
/** This section will hold my button logic */

// Controller 1 Variables
var maxSkillPoints = 24;
var currentSkillPoints = 0;
var remainingSkillPoints = 24;
var amount1 = 0;
var amount2 = 0;
var amount3 = 0;
var amount4 = 0;
var amount5 = 0;
var amount6 = 0;


/** attributesUpdate function
 * Updates max for all buttons
 */

function attributesUpdate() {
    console.log("Updating Max");
    $("#attrAw").attr("max", remainingSkillPoints + amount1);
    $("#attrCo").attr("max", remainingSkillPoints + amount2);
    $("#attrIn").attr("max", remainingSkillPoints + amount3);
    $("#attrPr").attr("max", remainingSkillPoints + amount4);
    $("#attrRe").attr("max", remainingSkillPoints + amount5);
    $("#attrSt").attr("max", remainingSkillPoints + amount6);
};

/** traitsUpdate
 * Disables buttons based on remainding skill points
 */

 function traitsUpdate() {
     console.log("Traits Update function called");
     $(":checkbox").each(function () {
         var cost = +($(this).attr("cost"));
         console.log($(this).prop('checked'))
         if (remainingSkillPoints < cost && !($(this).prop('checked'))) {
            $(this).attr("disabled", true);
         } else {
            $(this).attr("disabled", false);
         }
    });
 }

/** Controller Function
 *  Updates Current skill points used in both section
 * if we have not over spent are skill points
 * call update attribute buttons and traits button
 * if we have over spent
 * call disable all neccessary buttons (traits and skills)
 */

function controller() {
    console.log("Controller function called");
    amount1 = +($("#attrAw").val().trim());
    amount2 = +($("#attrCo").val().trim());
    amount3 = +($("#attrIn").val().trim());
    amount4 = +($("#attrPr").val().trim());
    amount5 = +($("#attrRe").val().trim());
    amount6 = +($("#attrSt").val().trim());
    var traitCount = 0;
    $(":checkbox:checked").each(function () {
        traitCount += +($(this).attr("cost"));
    });
    currentSkillPoints = amount1 + amount2 + amount3 + amount4 + amount5 + amount6 + traitCount;
    console.log("Current skill points " + currentSkillPoints)
    

    if (currentSkillPoints <= 24) {
        remainingSkillPoints = maxSkillPoints - currentSkillPoints;
        console.log("Curren remainder " + remainingSkillPoints);
        attributesUpdate()
        traitsUpdate();
    } else {
        console.log("you ran out of points");
    }

};

/** Controller Function
 * Updates current skill points used
 * checks if user has sufficient funds
 * calls attribute function
 * calls traits
 */
//-Controller 2 Variables
var maxSkillPoints2 = 18;
var currentSkillPoints2 = 0;
var remainingSkillPoints2 = 18;
var amount7 = 0;
var amount8 = 0;
var amount9 = 0;
var amount10 = 0;
var amount11 = 0;
var amount12 = 0;
var amount13 = 0;
var amount14 = 0;
var amount15 = 0;
var amount16 = 0;
var amount17 = 0;
var amount18 = 0;

function attributesUpdate2() {
    console.log("Updating Max");
    $('#skAthletics').attr('max', remainingSkillPoints2 + amount7);
    $('#skConvince').attr('max', remainingSkillPoints2 + amount8);
    $('#skCraft').attr('max', remainingSkillPoints2 + amount9);
    $('#skFighting').attr('max', remainingSkillPoints2 + amount10);
    $('#skKnowledge').attr('max', remainingSkillPoints2 + amount11);
    $('#skMarksman').attr('max', remainingSkillPoints2 + amount12);
    $('#skMedicine').attr('max', remainingSkillPoints2 + amount13);
    $('#skScience').attr('max', remainingSkillPoints2 + amount14);
    $('#skSubterfuge').attr('max', remainingSkillPoints2 + amount15);
    $('#skSurvival').attr('max', remainingSkillPoints2 + amount16);
    $('#skTechnology').attr('max', remainingSkillPoints2 + amount17);
    $('#skTransport').attr('max', remainingSkillPoints2 + amount18);

}

function controller2() {
    amount7 = +($('#skAthletics').val().trim());
    amount8 = +($('#skConvince').val().trim());
    amount9 = +($('#skCraft').val().trim());
    amount10 = +($('#skFighting').val().trim());
    amount11 = +($('#skKnowledge').val().trim());
    amount12 = +($('#skMarksman').val().trim());
    amount13 = +($('#skMedicine').val().trim());
    amount14 = +($('#skScience').val().trim());
    amount15 = +($('#skSubterfuge').val().trim());
    amount16 = +($('#skSurvival').val().trim());
    amount17 = +($('#skTechnology').val().trim());
    amount18 = +($('#skTransport').val().trim());
    currentSkillPoints2 = amount7 + amount8 + amount9 + amount10 + amount11 + amount12 + amount13 + amount14 + amount15 + amount16 + amount17 + amount18;
    console.log("Current skill points 2 is at " + currentSkillPoints2)

    if (currentSkillPoints2 <= 18) {
        remainingSkillPoints2 = maxSkillPoints2 - currentSkillPoints2;
        attributesUpdate2()
    } else {
        console.log("you ran out of points");
    }
}

/** This Section Will hold character creation  */
// Saves all information in an object for easy uploading

function saveCharacter() {
    console.log("save character function called");
    var character = {
        Attributes: {
            Awareness: amount1,
            Coordination: amount2,
            Ingenuity: amount3,
            Presence: amount4,
            Resolve: amount5,
            Strength: amount6
        },
        Traits: {

        },
        Skills: {
            Athletics: amount7,
            Convince: amount8,
            Craft: amount9,
            Fighting: amount10,
            Knowledge: amount11,
            Marksman: amount12,
            Medicine: amount13,
            Science: amount14,
            Subterfuge: amount15,
            Survival: amount16,
            Technology: amount17,
            Transport: amount18

        }
    };

    $(":checkbox:checked").each(function () {
        var trait = $(this).attr("id");
        character.Traits[trait] = true;



    });


    console.log(character);

}

// function () {
//     $(":checkbox").each(function () {
//         console.log(this);
//         var trait = $(this).attr("id");
//         var cost = $(this).attr("cost");
//         console.log("The id for this is " + trait);
//         console.log("The cost for this is " + cost);
//         this[trait] = cost;
//    });
// }
// $("#submit").on('click', function () {
//     event.preventDefault();
//   });
// $( "#saveChar" ).click(function() {
//     alert( "Handler for .click() called." );
//   });


  </script>
</body>

</html>
